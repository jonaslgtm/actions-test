# å·¥ä½œæµåç§°
name: Daily Date Update

# å®šä¹‰è§¦å‘æ¡ä»¶
on:
  # 1. å®šæ—¶è§¦å‘ - æ¯å¤© UTC æ—¶é—´ 00:00 (åŒ—äº¬æ—¶é—´ 08:00) è¿è¡Œ
  schedule:
      - cron: '0 0 * * *' # cron è¯­æ³•: åˆ† æ—¶ æ—¥ æœˆ å‘¨
        timezone: Asia/Shanghai # è®¾ç½®æ—¶åŒºä¸ºåŒ—äº¬æ—¶é—´ï¼ˆAsia/Shanghaiï¼‰
    # æ³¨æ„: GitHub Actions ä½¿ç”¨ UTC æ—¶é—´
    # å¦‚æœè¦è°ƒæ•´åˆ°ç‰¹å®šæ—¶é—´è¿è¡Œï¼Œå¯ä»¥ä¿®æ”¹è¿™ä¸ª cron è¡¨è¾¾å¼
  
  # 2. å…è®¸æ‰‹åŠ¨è§¦å‘å·¥ä½œæµ
  workflow_dispatch:
  
  # 3. å¯é€‰: å½“ README.md æ–‡ä»¶è¢«ä¿®æ”¹æ—¶ä¹Ÿè§¦å‘ (æ ¹æ®éœ€è¦å–æ¶ˆæ³¨é‡Š)
  # push:
  #   paths:
  #     - 'README.md'

# å·¥ä½œæµä»»åŠ¡
jobs:
  update-date:
    # è¿è¡Œåœ¨æœ€æ–°ç‰ˆæœ¬çš„ Ubuntu ç³»ç»Ÿä¸Š
    runs-on: ubuntu-latest
    
    # ä»»åŠ¡æ­¥éª¤
    steps:
      # æ­¥éª¤ 1: æ£€å‡ºä»£ç åº“
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # è·å–å®Œæ•´å†å²è®°å½•ï¼Œä»¥ä¾¿èƒ½å¤Ÿæ¨é€æ›´æ”¹
          fetch-depth: 0
          
      # è®¾ç½®è™šæ‹Ÿç¯å¢ƒçš„æ—¶åŒºä¸ºåŒ—äº¬æ—¶é—´
      - name: Set timezone to Asia/Shanghai
        run: sudo timedatectl set-timezone Asia/Shanghai
      
      # æ­¥éª¤ 2: è®¾ç½® Python ç¯å¢ƒ (ç”¨äºæ—¥æœŸå¤„ç†)
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'  # ä½¿ç”¨ä»»ä½•å¯ç”¨çš„ Python 3 ç‰ˆæœ¬
      
      # æ­¥éª¤ 3: æ›´æ–° README ä¸­çš„æ—¥æœŸ
      - name: Update date in README
        run: |
          # è·å–å½“å‰æ—¥æœŸå¹¶æ ¼å¼åŒ–ä¸º "YYYYå¹´MæœˆDæ—¥" æ ¼å¼
          # ä½¿ç”¨ Python ç¡®ä¿æ—¥æœŸæ ¼å¼æ­£ç¡®
          CURRENT_DATE=$(python -c "from datetime import datetime; print(datetime.now().strftime('%Yå¹´%-mæœˆ%-dæ—¥'))")
          
          # ä½¿ç”¨ sed å‘½ä»¤æ›¿æ¢ README.md ä¸­çš„æ—¥æœŸ
          # æŸ¥æ‰¾æ¨¡å¼: "ä»Šå¤©æ˜¯ï¼šä»»ä½•æ—¥æœŸ"
          # æ›¿æ¢ä¸º: "ä»Šå¤©æ˜¯ï¼šå½“å‰æ—¥æœŸ"
          sed -i "s/ä»Šå¤©æ˜¯ï¼š.*/ä»Šå¤©æ˜¯ï¼š$CURRENT_DATE/" README.md
          
          # å¯é€‰: æ‰“å°æ›´æ”¹ä¿¡æ¯
          echo "Updated date to: $CURRENT_DATE"
      
      # æ­¥éª¤ 4: é…ç½® Git ç”¨æˆ·
      - name: Configure Git
        run: |
          git config --local user.name "github-actions[bot]"
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
      
      # æ­¥éª¤ 5: æäº¤æ›´æ”¹
      - name: Commit changes
        run: |
          # æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ”¹éœ€è¦æäº¤
          if git diff --quiet; then
            echo "No changes to commit"
            exit 0
          fi
          
          # æ·»åŠ æ›´æ”¹çš„æ–‡ä»¶
          git add README.md
          
          # æäº¤æ›´æ”¹
          git commit -m "ğŸ¤– Daily Auto Update"
      
      # æ­¥éª¤ 6: æ¨é€æ›´æ”¹
      - name: Push changes
        # ä½¿ç”¨ GitHub Actions çš„å†…ç½®ä»¤ç‰Œæ¨é€æ›´æ”¹
        run: git push
